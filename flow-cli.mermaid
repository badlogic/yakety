---
title: Yakety CLI App Flow - Much Simpler Than Tray App
---
flowchart TD
    subgraph MT ["Main Thread"]
        A[App Start] --> B[Parse Command Line Args]
        B --> C{Help Requested?}
        C -->|Yes| D[Show Help & Exit]
        
        C -->|No| E[Initialize Logging]
        E --> F[Load Configuration]
        F --> G{Custom Model Path?}
        G -->|Yes| H[Override Model in Config]
        G -->|No| I[Setup Signal Handlers]
        H --> I
        
        I --> J[Initialize App Framework]
        J --> K[Initialize Overlay]
        K --> L[Create Audio Recorder]
        L --> M[Start App Run Loop]
        M --> N[Start Async Model Loading]
        
        N --> O{Model Load Success?}
        O -->|No| P{First Attempt?}
        P -->|Yes| Q[Log Fallback Message]
        Q --> R[Clear Model Config]
        R --> S[Retry with Base Model]
        S --> N
        P -->|No| T[Log Error & Exit]
        O -->|Yes| U[Initialize Keylogger]
        
        U --> V{Keylogger Success?}
        V -->|No| W[Log Error & Exit]
        V -->|Yes| X[Load Saved Hotkey]
        X --> Y[Ready - Main Loop]
        
        Y --> Z{Hotkey Pressed?}
        Z -->|Yes| AA[Start Recording]
        AA --> BB{Hotkey Released?}
        BB -->|Yes| CC[Stop Recording]
        CC --> DD[Get Audio Samples]
        DD --> EE[Transcribe Audio Sync]
        EE --> FF{Text Found?}
        FF -->|Yes| GG[Copy & Paste Text]
        FF -->|No| HH[Log No Speech]
        GG --> Y
        HH --> Y
        
        BB -->|No| AA
        Z -->|No| II{SIGINT/SIGTERM?}
        II -->|Yes| JJ[Cleanup & Exit]
        II -->|No| Y
    end
    
    subgraph AT ["Auxiliary Threads"]
        AT1[Model Loading Task]
        AT1 --> AT2[Load Whisper Model]
        AT2 --> AT3[Set Language]
        AT3 --> AT4[Return Success/Failure]
    end
    
    subgraph SYS ["System Events"]
        SYS1[Keyboard Hotkey Events]
        SYS2[Signal Events SIGINT/SIGTERM]
    end
    
    %% Connections between threads
    N -.-> AT1
    AT4 -.-> O
    
    SYS1 -.-> Z
    SYS2 -.-> II
    
    %% Styling
    classDef mainThread fill:#e1f5fe
    classDef auxThread fill:#f3e5f5
    classDef systemEvent fill:#e8f5e8
    classDef exitNode fill:#ffebee
    
    class A,B,C,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,U,V,X,Y,Z,AA,BB,CC,DD,EE,FF,GG,HH,II mainThread
    class AT1,AT2,AT3,AT4 auxThread
    class SYS1,SYS2 systemEvent
    class D,T,W,JJ exitNode